name: Telegram File Bot Runner
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */4 * * *'  # هر 4 ساعت اجرا شود

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
    - name: Setup Python Environment
      run: |
        sudo apt-get update
        sudo apt-get install -y python3 python3-pip
        pip3 install python-telegram-bot

    - name: Create Bot Script
      run: |
        cat > telegram_bot.py << 'EOF'
# کد پایتون بالا اینجا قرار می‌گیرد
# [کد کامل پایتون از بالا اینجا کپی شود]
EOF

    - name: Run Telegram Bot
      run: |
        echo "🤖 شروع ربات تلگرام..."
        echo "🔗 توکن: 7897337548:AAGudjNDkUM5pUWx93mdc6kFBrSqusuj_NA"
        
        # اجرای ربات به مدت 3 ساعت
        timeout 10800 python3 telegram_bot.py || echo "⏰ زمان ربات به پایان رسید"
        
        echo "✅ ربات با موفقیت اجرا شد"

    - name: Send Startup Notification
      run: |
        # ارسال پیام شروع به کار
        curl -s -X POST \
          "https://api.telegram.org/bot7897337548:AAGudjNDkUM5pUWx93mdc6kFBrSqusuj_NA/sendMessage" \
          -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d "text=🟢 ربات فعال شد! می‌تونید فایل ارسال کنید" \
          -d "parse_mode=HTML"

    - name: Keep Logs
      run: |
        echo "📋 لاگ ربات:"
        echo "ربات به مدت 3 ساعت اجرا شد"
        echo "برای اجرای مجدد، workflow را دوباره run کنید"
