name: Simple File to Link Converter
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # هر 6 ساعت اجرا شود

jobs:
  file-converter:
    runs-on: ubuntu-latest
    steps:
    - name: Setup environment
      run: |
        sudo apt-get update
        sudo apt-get install -y python3 python3-pip ffmpeg
        pip3 install python-telegram-bot ffmpeg-python

    - name: Create simple bot script
      run: |
        cat > simple_bot.py << 'EOF'
#!/usr/bin/env python3
import os
import asyncio
from telegram import Update
from telegram.ext import Application, MessageHandler, filters

TOKEN = "7897337548:AAGudjNDkUM5pUWx93mdc6kFBrSqusuj_NA"

async def handle_message(update: Update, context):
    try:
        if update.message.video:
            await update.message.reply_text("🎥 ویدیو دریافت شد! (امکان پردازش در این نسخه)")
        
        elif update.message.document:
            await update.message.reply_text("📄 فایل دریافت شد! (امکان پردازش در این نسخه)")
        
        elif update.message.photo:
            await update.message.reply_text("📷 عکس دریافت شد!")
        
        else:
            await update.message.reply_text("🤖 ربات فعال است! فایل ارسال کنید")

    except Exception as e:
        await update.message.reply_text("❌ خطا: " + str(e))

async def main():
    app = Application.builder().token(TOKEN).build()
    app.add_handler(MessageHandler(filters.ALL, handle_message))
    
    print("🤖 Bot starting...")
    await app.run_polling()

if __name__ == "__main__":
    asyncio.run(main())
EOF

    - name: Run bot for limited time
      run: |
        echo "🔄 اجرای ربات به مدت 10 دقیقه..."
        timeout 600 python3 simple_bot.py || echo "⏰ زمان ربات به پایان رسید"
        
        echo "✅ کار ربات کامل شد"
        echo "📋 می‌توانید دوباره اجرا کنید"
